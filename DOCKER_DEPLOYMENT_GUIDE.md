# Logan Security Dashboard - Docker Deployment Guide

This guide provides comprehensive instructions for deploying the Logan Security Dashboard using Docker in any cloud environment.

## üîí Security Notice

**IMPORTANT: NO HARDCODED CREDENTIALS**

This codebase contains **no hardcoded passwords, API keys, or sensitive information**. All credentials must be provided through environment variables. 

**Before deployment:**
1. Generate secure secrets using the provided script
2. Configure all required environment variables
3. Never commit `.env` files to version control
4. Use different secrets for each environment

See [SECURITY_CREDENTIALS_GUIDE.md](SECURITY_CREDENTIALS_GUIDE.md) for detailed security configuration.

## üöÄ Quick Start

### Prerequisites
- Docker 20.x or higher
- Docker Compose 2.x or higher
- 4GB+ RAM available
- 10GB+ disk space

### Basic Deployment

1. **Clone and Setup**
```bash
git clone <repository-url>
cd logan-security-dashboard
cp .env.production.example .env.production
```

2. **Generate Secure Secrets**
```bash
# Generate cryptographically secure secrets
chmod +x scripts/generate-secrets.sh
./scripts/generate-secrets.sh production
```

3. **Configure Environment**
Copy the generated secrets and update `.env.production`:
```bash
# Copy generated secrets
cat .env.production.secrets >> .env.production

# Edit with your specific OCI and database values
nano .env.production

# Essential configuration (update with your actual values)
LOGAN_REGION=us-ashburn-1
LOGAN_COMPARTMENT_ID=ocid1.compartment.oc1..your-actual-id
ORACLE_DB_USER=your-actual-db-user
ORACLE_DB_PASSWORD=your-actual-db-password
# Encryption keys will be auto-generated by the script
```

4. **Deploy**
```bash
chmod +x deploy/docker-deploy.sh
./deploy/docker-deploy.sh
```

4. **Access Application**
- URL: http://localhost:3000
- Health Check: http://localhost:3000/api/health

## üìã Deployment Options

### Option 1: Automated Script Deployment

Use the provided deployment script for full automation:

```bash
# Basic deployment
./deploy/docker-deploy.sh

# With options
./deploy/docker-deploy.sh --env production --tag v1.0.0 --backup --cleanup

# Cloud-specific deployment
./deploy/docker-deploy.sh --cloud aws --env production
./deploy/docker-deploy.sh --cloud azure --env production
./deploy/docker-deploy.sh --cloud gcp --env production
```

**Script Options:**
- `--env ENV`: Deployment environment (default: production)
- `--tag TAG`: Docker image tag (default: latest)
- `--registry REG`: Docker registry (default: logan-security)
- `--cloud PROVIDER`: Cloud provider (aws|azure|gcp|local)
- `--backup`: Create backup before deployment
- `--cleanup`: Clean up old volumes after deployment
- `--pull`: Pull latest images before deployment

### Option 2: Manual Docker Compose

```bash
# Build and start services
docker-compose -f docker-compose.production.yml up -d

# View logs
docker-compose -f docker-compose.production.yml logs -f

# Stop services
docker-compose -f docker-compose.production.yml down
```

### Option 3: Kubernetes Deployment

```bash
# Apply Kubernetes manifests
kubectl apply -f deploy/kubernetes.yml

# Or use Helm
helm install logan-dashboard deploy/helm/ -f deploy/helm/values.yaml
```

## üèóÔ∏è Architecture Overview

### Docker Images

#### Main Application Image
- **Base**: Node.js 20 Alpine
- **Size**: ~500MB (production optimized)
- **Features**: 
  - Multi-stage build for minimal size
  - Non-root user for security
  - Health checks included
  - Python integration for OCI scripts

#### Optional Services
- **Redis**: Caching and session storage
- **Nginx**: Reverse proxy and SSL termination

### Container Structure

```
logan-dashboard/
‚îú‚îÄ‚îÄ app/                    # Application code
‚îú‚îÄ‚îÄ scripts/               # Python OCI scripts
‚îú‚îÄ‚îÄ config/               # Configuration files
‚îú‚îÄ‚îÄ wallet_unzipped/      # Oracle wallet (mounted)
‚îú‚îÄ‚îÄ logs/                 # Application logs (volume)
‚îú‚îÄ‚îÄ temp/                 # Temporary files (volume)
‚îî‚îÄ‚îÄ uploads/              # User uploads (volume)
```

## ‚öôÔ∏è Configuration

### Environment Variables

#### Required Variables
```bash
# Oracle Cloud Infrastructure
LOGAN_REGION=us-ashburn-1
LOGAN_COMPARTMENT_ID=ocid1.compartment.oc1..your-id
LOGAN_NAMESPACE=your-namespace

# Database
ORACLE_DB_USER=your-db-user
ORACLE_DB_PASSWORD=your-db-password
ORACLE_DB_CONNECTION_STRING=your-connection-string

# Security
ENCRYPTION_KEY=your-32-character-encryption-key-here
SESSION_SECRET=your-session-secret-minimum-32-chars
```

#### Optional Variables
```bash
# Performance
CACHE_TTL=3600
MAX_QUERY_RESULTS=10000
QUERY_TIMEOUT=30000

# Features
FEATURE_ADVANCED_ANALYTICS=true
FEATURE_THREAT_INTELLIGENCE=true
RITA_ENABLED=false

# External Services
N8N_WEBHOOK_URL=https://your-n8n-instance.com/webhook
REDIS_ENABLED=true
```

### Oracle Wallet Configuration

1. **Place wallet files** in `wallet_unzipped/` directory
2. **Set TNS_ADMIN** environment variable: `TNS_ADMIN=/app/wallet_unzipped`
3. **Ensure wallet files** have proper permissions (readable by container user)

### SSL/TLS Configuration

#### Development (Self-signed)
Certificates are auto-generated during deployment.

#### Production
1. Place certificates in `nginx/ssl/`:
   - `logan.crt` (certificate)
   - `logan.key` (private key)

2. Update nginx configuration if needed

## üåç Cloud Provider Deployments

### Amazon Web Services (AWS)

#### EC2 Deployment
```bash
# Install Docker on EC2
sudo yum update -y
sudo yum install -y docker
sudo service docker start

# Deploy Logan Dashboard
./deploy/docker-deploy.sh --cloud aws
```

#### ECS Deployment
```bash
# Set AWS variables
export AWS_REGION=us-east-1
export AWS_ACCOUNT_ID=123456789012
export ECS_CLUSTER=logan-cluster
export ECS_SERVICE=logan-service

# Deploy to ECS
./deploy/docker-deploy.sh --cloud aws
```

#### ECR Registry
```bash
# Push to ECR
aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin $AWS_ACCOUNT_ID.dkr.ecr.us-east-1.amazonaws.com

docker tag logan-security/logan-dashboard:latest $AWS_ACCOUNT_ID.dkr.ecr.us-east-1.amazonaws.com/logan-dashboard:latest

docker push $AWS_ACCOUNT_ID.dkr.ecr.us-east-1.amazonaws.com/logan-dashboard:latest
```

### Microsoft Azure

#### Azure Container Instances (ACI)
```bash
# Set Azure variables
export AZURE_RESOURCE_GROUP=logan-rg
export AZURE_LOCATION=eastus

# Deploy to ACI
./deploy/docker-deploy.sh --cloud azure
```

#### Azure Container Registry (ACR)
```bash
# Login to ACR
az acr login --name yourregistry

# Tag and push
docker tag logan-security/logan-dashboard:latest yourregistry.azurecr.io/logan-dashboard:latest
docker push yourregistry.azurecr.io/logan-dashboard:latest
```

### Google Cloud Platform (GCP)

#### Cloud Run Deployment
```bash
# Set GCP variables
export GOOGLE_CLOUD_PROJECT=your-project-id
export GCP_REGION=us-central1

# Deploy to Cloud Run
./deploy/docker-deploy.sh --cloud gcp
```

#### Container Registry
```bash
# Configure Docker for GCR
gcloud auth configure-docker

# Tag and push
docker tag logan-security/logan-dashboard:latest gcr.io/$GOOGLE_CLOUD_PROJECT/logan-dashboard:latest
docker push gcr.io/$GOOGLE_CLOUD_PROJECT/logan-dashboard:latest
```

### Oracle Cloud Infrastructure (OCI)

#### Container Engine for Kubernetes (OKE)
```bash
# Deploy to OKE
kubectl apply -f deploy/kubernetes.yml
```

#### Container Registry (OCIR)
```bash
# Login to OCIR
docker login <region-key>.ocir.io

# Tag and push
docker tag logan-security/logan-dashboard:latest <region-key>.ocir.io/<tenancy-namespace>/logan-dashboard:latest
docker push <region-key>.ocir.io/<tenancy-namespace>/logan-dashboard:latest
```

## üîß Operations

### Health Monitoring

#### Health Check Endpoint
```bash
# Check application health
curl http://localhost:3000/api/health

# Response example
{
  "status": "healthy",
  "timestamp": "2024-01-20T10:30:00.000Z",
  "version": "1.0.0",
  "uptime": 3600,
  "checks": {
    "database": {"status": "healthy", "responseTime": 45},
    "memory": {"status": "healthy", "usage": 65, "limit": 2147483648},
    "disk": {"status": "healthy", "usage": 23, "available": 8589934592},
    "python": {"status": "healthy", "version": "Python 3.11.7"}
  }
}
```

### Logs Management

#### View Logs
```bash
# Application logs
docker-compose -f docker-compose.production.yml logs -f logan-dashboard

# All services logs
docker-compose -f docker-compose.production.yml logs -f

# Nginx access logs
docker-compose -f docker-compose.production.yml exec nginx tail -f /var/log/nginx/access.log
```

#### Log Rotation
Logs are automatically rotated using Docker's logging driver:
```yaml
logging:
  driver: "json-file"
  options:
    max-size: "100m"
    max-file: "10"
```

### Backup and Recovery

#### Automated Backup
```bash
# Create backup
./deploy/docker-deploy.sh --backup

# Manual backup
docker-compose -f docker-compose.production.yml exec logan-dashboard tar -czf /app/backups/backup-$(date +%Y%m%d_%H%M%S).tar.gz /app/logs /app/uploads /app/config
```

#### Data Recovery
```bash
# Stop services
docker-compose -f docker-compose.production.yml down

# Restore data
tar -xzf backup-20240120_103000.tar.gz -C /

# Start services
docker-compose -f docker-compose.production.yml up -d
```

### Scaling

#### Horizontal Scaling
```bash
# Scale to 3 instances
docker-compose -f docker-compose.production.yml up -d --scale logan-dashboard=3

# With load balancer
docker-compose -f docker-compose.production.yml up -d --scale logan-dashboard=3 nginx
```

#### Kubernetes Scaling
```bash
# Scale deployment
kubectl scale deployment logan-dashboard --replicas=5

# Auto-scaling is configured via HPA in kubernetes.yml
```

## üîí Security

### Container Security

#### Security Scanning
```bash
# Scan for vulnerabilities
docker scan logan-security/logan-dashboard:latest

# Use Trivy for detailed scanning
trivy image logan-security/logan-dashboard:latest
```

#### Security Best Practices
- ‚úÖ Non-root user (uid: 1001)
- ‚úÖ Read-only root filesystem where possible
- ‚úÖ Dropped ALL capabilities
- ‚úÖ No privilege escalation
- ‚úÖ Security updates in base image
- ‚úÖ Secrets management via environment variables
- ‚úÖ Network policies in Kubernetes

### Network Security

#### Firewall Rules
```bash
# Allow only necessary ports
ufw allow 80/tcp    # HTTP
ufw allow 443/tcp   # HTTPS
ufw allow 22/tcp    # SSH (management)
```

#### SSL/TLS Configuration
- TLS 1.2 and 1.3 only
- Strong cipher suites
- HSTS headers
- Security headers (CSP, X-Frame-Options, etc.)

## üö® Troubleshooting

### Common Issues

#### 1. Container Won't Start
```bash
# Check logs
docker-compose -f docker-compose.production.yml logs logan-dashboard

# Common causes:
# - Missing environment variables
# - Oracle wallet not mounted correctly
# - Port conflicts
# - Insufficient resources
```

#### 2. Database Connection Issues
```bash
# Test database connectivity
docker-compose -f docker-compose.production.yml exec logan-dashboard python3 /app/scripts/test-oracle-connection.js

# Check wallet configuration
docker-compose -f docker-compose.production.yml exec logan-dashboard ls -la /app/wallet_unzipped/
```

#### 3. Performance Issues
```bash
# Check resource usage
docker stats

# Check memory usage
docker-compose -f docker-compose.production.yml exec logan-dashboard free -h

# Check disk usage
docker-compose -f docker-compose.production.yml exec logan-dashboard df -h
```

#### 4. SSL Certificate Issues
```bash
# Check certificate validity
openssl x509 -in nginx/ssl/logan.crt -text -noout

# Test SSL connection
openssl s_client -connect localhost:443 -servername logan.your-domain.com
```

### Debug Mode

#### Enable Debug Logging
```bash
# Set environment variable
echo "LOG_LEVEL=debug" >> .env.production

# Restart services
docker-compose -f docker-compose.production.yml restart
```

#### Access Container Shell
```bash
# Access application container
docker-compose -f docker-compose.production.yml exec logan-dashboard sh

# Access nginx container
docker-compose -f docker-compose.production.yml exec nginx sh
```

## üìä Monitoring and Metrics

### Prometheus Metrics
Health check endpoint provides metrics at `/api/health`

### Custom Monitoring
```bash
# Add monitoring container to docker-compose.yml
# Example: Prometheus, Grafana, or custom monitoring solution
```

## üîÑ Updates and Maintenance

### Rolling Updates
```bash
# Build new image
docker build -f Dockerfile.production -t logan-security/logan-dashboard:v1.1.0 .

# Update with zero downtime
./deploy/docker-deploy.sh --tag v1.1.0
```

### Maintenance Mode
```bash
# Stop application (keep data)
docker-compose -f docker-compose.production.yml stop logan-dashboard

# Maintenance tasks...

# Start application
docker-compose -f docker-compose.production.yml start logan-dashboard
```

## üìû Support

### Getting Help
- Check logs first: `docker-compose logs`
- Review this guide thoroughly
- Check health endpoint: `/api/health`
- Verify environment configuration

### Reporting Issues
Include the following information:
- Docker version: `docker --version`
- Compose version: `docker-compose --version`
- Error logs from containers
- Environment configuration (sanitized)
- Steps to reproduce

This deployment guide ensures Logan Security Dashboard can be successfully deployed and operated in any cloud environment with Docker support.